#!/usr/bin/env ruby

require 'fileutils'

dotbundles = File.join(ENV['HOME'], '.vim', 'bundle')
bundles = File
  .readlines(File.join(ENV['HOME'], '.vim_bundles'))
  .map(&:strip)
  .compact
  .reject { |str| str.start_with?('#') }
  .sort_by { |str| File.basename(str) }

FileUtils.cd(dotbundles)

puts 'Updating bundles:'
bundles.each do |url|
  plugin_name = File.basename(url).sub('.git', '')
  print "  --> #{plugin_name}"

  if File.exists?(File.join(dotbundles, plugin_name))
    FileUtils.cd(File.join(dotbundles, plugin_name)) do
      system "git checkout --quiet master && git pull --quiet &> /dev/null"
    end
  else
    system "git clone --quiet #{url} #{plugin_name}"
    print ' *'
  end
  puts
end
